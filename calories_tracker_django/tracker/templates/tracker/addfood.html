<!DOCTYPE html>
<html>
<head>
    <title>Add Food | CalPro</title>
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>

<nav class="navbar">
    <div class="logo">CalPro</div>
    <a href="/home/">Dashboard</a>
</nav>


<div class="addfood-container">

    <h2>üçΩ Add Food</h2>

    <!-- RADIO INPUTS MUST COME FIRST -->
    <input type="radio" name="tab" id="predefined" checked>
    <input type="radio" name="tab" id="custom">
    <input type="radio" name="tab" id="favorites">

    <!-- TABS -->
    <div class="food-tabs">
        <label for="predefined">Predefined</label>
        <label for="custom">Custom</label>
        <label for="favorites">Favorites</label>
    </div>

    <!-- FORMS -->
    <div class="food-forms">

       <form class="form predefined"  method="POST">
        {% csrf_token %}
    <h3>ü•ó Predefined Food</h3>

 <select id="food_select" name="food_id" onchange="calculateTotal()">
        {% for food in foods %}
        <option 
            value="{{ food.id }}"
            data-cal="{{ food.calories }}"
            data-pro="{{ food.protein }}">
            {{ food.name }}
        </option>
        {% endfor %}
    </select>
<input 
        type="number" 
        name="quantity"
        id="quantity"
        value="1"
        min="1"
        oninput="calculateTotal()">

<div class="result-box">
    <p>Total Calories: <span id="total_cal">0</span> kcal</p>
    <p>Total Protein: <span id="total_pro">0</span> g</p>
</div>
<script>
function calculateTotal() {
    const select = document.getElementById("food_select");
    const option = select.options[select.selectedIndex];

    const cal = Number(option.dataset.cal) || 0;
    const pro = Number(option.dataset.pro) || 0;
    const qty = Number(document.getElementById("quantity").value) || 1;

    const totalCal = cal * qty;
    const totalPro = pro * qty;

    document.getElementById("total_cal").innerText = totalCal;
    document.getElementById("total_pro").innerText = totalPro;

    document.getElementById("hidden_cal").value = totalCal;
    document.getElementById("hidden_pro").value = totalPro;
}
</script>







    

   

<input type="hidden" name="total_calories" id="hidden_cal">
    <input type="hidden" name="total_protein" id="hidden_pro">
<!-- fav -->



<div class="favorite-toggle-custom">
    <label class="switch">
        <input type="checkbox" name="save_favorite" id="save_fav_predefined">
        <span class="slider round"></span>
    </label>
    <span class="save_fav_predefined">Add to Favorites</span>
</div>





   <br> <button type="submit">Add Food</button>
   <script>
function calculateTotal() {
    const select = document.getElementById("food_select");
    const qtyInput = document.getElementById("quantity");

    if (!select || !qtyInput) return;

    const option = select.options[select.selectedIndex];

    const cal = Number(option.dataset.cal) || 0;
    const pro = Number(option.dataset.pro) || 0;
    const qty = Number(qtyInput.value) || 1;

    const totalCal = cal * qty;
    const totalPro = pro * qty;

    document.getElementById("total_cal").innerText = totalCal;
    document.getElementById("total_pro").innerText = totalPro;

    document.getElementById("hidden_cal").value = totalCal;
    document.getElementById("hidden_pro").value = totalPro;
}

document.addEventListener("DOMContentLoaded", function () {
    calculateTotal();
});
</script>

</form>








<form class="form custom"
      id="customForm"
      method="POST"
      action="{% url 'add_custom_food' %}">
    {% csrf_token %}

    <h3>‚úç Custom Food</h3>

    <input type="text"
           id="food_name"
           name="food_name"
           placeholder="Food name"
           required>

    <input type="number"
           id="custom_cal"
           name="custom_cal"
           placeholder="Calories per unit"
           oninput="calculateCustom()"
           required>

    <input type="number"
           id="custom_protein"
           name="custom_protein"
           placeholder="Protein per unit"
           oninput="calculateCustom()"
           required>

    <input type="number"
           id="custom_qty"
           name="custom_qty"
           value="1"
           min="1"
           oninput="calculateCustom()">

    <!-- DISPLAY -->
    <div class="result-box">
        <p>Total Calories: <span id="custom_total_cal">0</span> kcal</p>
        <p>Total Protein: <span id="custom_total_protein">0</span> g</p>
    </div>

    <!-- üîë HIDDEN INPUTS -->
    <input type="hidden" name="custom_total_calories" id="custom_total_calories">
    <input type="hidden" name="custom_total_protein_val" id="custom_total_protein_val">
<!-- CUSTOM FORM - Add this before the button -->
<div class="favorite-toggle-custom">
    <label class="switch">
        <input type="checkbox" name="save_favorite" id="save_fav_custom">
        <span class="slider round"></span>
    </label>
    <span class="toggle-label">Add to Favorites</span>
</div>
    <button type="submit">Add Food</button>
    <script>
function calculateCustom() {
    const cal = Number(document.getElementById("custom_cal").value) || 0;
    const protein = Number(document.getElementById("custom_protein").value) || 0;
    const qty = Number(document.getElementById("custom_qty").value) || 1;

    const totalCal = cal * qty;
    const totalProtein = protein * qty;

    // UI
    document.getElementById("custom_total_cal").innerText = totalCal;
    document.getElementById("custom_total_protein").innerText = totalProtein;

    // Backend
    document.getElementById("custom_total_calories").value = totalCal;
    document.getElementById("custom_total_protein_val").value = totalProtein;
}
</script>

</form>





        <form class="form favorites" method="POST">
    {% csrf_token %}
    <h3>‚≠ê Favorites</h3>
    
    <select id="fav_select" name="favorite_id" onchange="fillFavoriteData()">
        {% for fav in favorites %}
        <option 
            value="{{ fav.id }}"
            data-cal="{{ fav.calories }}"
            data-pro="{{ fav.protein }}"
            data-is-custom="{% if fav.custom_name %}1{% else %}0{% endif %}"
            data-name="{{ fav.custom_name|default:fav.food.name }}">
            {{ fav.custom_name|default:fav.food.name }}
        </option>
        {% empty %}
        <option>No favorites yet</option>
        {% endfor %}
    </select>
    
    <input type="number" name="quantity" id="fav_qty" value="1" min="1" oninput="calcFavorite()">
    
    <!-- Hidden fields to submit totals -->
    <input type="hidden" name="total_calories" id="fav_total_cal">
    <input type="hidden" name="total_protein" id="fav_total_pro">
    <input type="hidden" name="food_name" id="fav_food_name">
    
    <div class="result-box">
        <p>Total Calories: <span id="fav_display_cal">0</span> kcal</p>
        <p>Total Protein: <span id="fav_display_pro">0</span> g</p>
    </div>
    
    <button type="submit" formaction="{% url 'add_favorite_food' %}">Add Food</button>
    
    <script>
    function fillFavoriteData() {
        calcFavorite();
    }
    
    function calcFavorite() {
        const select = document.getElementById("fav_select");
        const option = select.options[select.selectedIndex];
        
        const cal = Number(option.dataset.cal) || 0;
        const pro = Number(option.dataset.pro) || 0;
        const qty = Number(document.getElementById("fav_qty").value) || 1;
        const name = option.dataset.name || "";
        
        const totalCal = cal * qty;
        const totalPro = pro * qty;
        
        document.getElementById("fav_display_cal").innerText = totalCal;
        document.getElementById("fav_display_pro").innerText = totalPro;
        
        document.getElementById("fav_total_cal").value = totalCal;
        document.getElementById("fav_total_pro").value = totalPro;
        document.getElementById("fav_food_name").value = name;
    }
    
    document.addEventListener("DOMContentLoaded", calcFavorite);
    </script>
</form>

    </div>
</div>

</body>
</html>
